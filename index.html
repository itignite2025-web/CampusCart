<!DOCTYPE html>
<html lang="ja">
<head>
<!-- PHOTO_SWAP_MARKER_V2: karaage_card->ebi_file / ebi_card->kara_file -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Campus Cart</title>

  
  <link rel="icon" type="image/png"
        href="/static/img/campuscart.png" />

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",
                   "Helvetica Neue",Arial,"Noto Sans JP",sans-serif;
      background: #f0f4fb;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      overflow-x: hidden;
    }

    .phone-shell {
      background: #d5e9ff;
      width: 360px;
      max-width: 100%;
      height: 640px;
      border-radius: 32px;
      border: 2px solid #4a7bbf;
      box-shadow: 0 10px 25px rgba(0,0,0,.2);
      overflow: hidden;
      position: relative;
      overflow-x: hidden;
    }

    .app-header {
      background: #7fb6ff;
      height: 80px;
      padding: 18px 18px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 2px solid #4a7bbf;
    }

    .search-wrapper {
      position: relative;
      flex: 1;
      margin-right: 12px;
    }

    .search-input {
      width: 100%;
      border-radius: 6px;
      border: none;
      padding: 6px 30px 6px 10px;
      font-size: 12px;
      outline: none;
      background: #e7f3ff;
    }
    .search-input.disabled {
      opacity: .5;
      pointer-events: none;
    }

    .search-icon {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 12px;
      opacity: .8;
    }

    .menu-icon {
      width: 32px;
      height: 20px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
    }
    .menu-icon span {
      display: block;
      height: 3px;
      border-radius: 3px;
      background: #fff;
    }
    .menu-icon.disabled {
      opacity: .5;
      pointer-events: none;
    }

    .app-main {
      padding: 32px 24px;
      text-align: center;
      height: calc(640px - 80px);
      overflow-y: auto;
      overflow-x: hidden;
      position: relative;
      scrollbar-gutter: stable;
      overflow-x: hidden !important;
    }

    /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ï¼ˆå•†å“ä¸€è¦§ãªã©ï¼‰ */
    .app-main {
      scrollbar-width: thin; /* Firefox */
      scrollbar-color: rgba(0,0,0,0.35) transparent;
    }
    .app-main::-webkit-scrollbar {
      width: 10px;
    }
    .app-main::-webkit-scrollbar-track {
      background: transparent;
    }
    .app-main::-webkit-scrollbar-thumb {
      background: rgba(0,0,0,0.35);
      border-radius: 10px;
    }


    .app-main.no-scroll {
      overflow-y: hidden;
      /* HOMEç”»é¢ã§ã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼è‡ªä½“ã‚’éè¡¨ç¤ºã«ã™ã‚‹ */
      scrollbar-width: none;           /* Firefox */
    }
    .app-main.no-scroll::-webkit-scrollbar {
      width: 0;                        /* Chrome, Edge, Safari */
      height: 0;
    }

    .screen { display:none; overflow-x:hidden; }
    .screen.active { display:block; }

    .icon-placeholder {
      width: 70%;
      max-width: 220px;
      aspect-ratio: 4/3;
      margin: 0 auto 24px;
      border: none;
      border-radius: 8px;
      background: transparent;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .icon-placeholder img {
      max-width: 90%;
      max-height: 90%;
      object-fit: contain;
      display:block;
    }

    .app-title {
      margin: 0 0 16px;
      font-size: 26px;
      font-weight: 700;
    }

    .catchcopy {
      margin: 0 0 32px;
      font-size: 16px;
      line-height: 1.6;
    }

    .oval-btn {
      display:inline-block;
      width:80%;
      max-width:260px;
      padding:14px 20px;
      border:none;
      border-radius:999px;
      background: radial-gradient(circle at 30% 30%,#aee0ff,#3389d8);
      box-shadow:0 6px 0 rgba(0,0,0,.25);
      font-size:16px;
      font-weight:600;
      color:#042645;
      cursor:pointer;
      text-decoration:none;
    }
    .oval-btn:active {
      transform: translateY(2px);
      box-shadow:0 4px 0 rgba(0,0,0,.2);
    }

    .rect-btn {
      display:inline-block;
      padding:10px 24px;
      border-radius:4px;
      background:#e5e5e5;
      border:1px solid #444;
      font-weight:600;
      cursor:pointer;
      text-decoration:none;
      color:#d90000;
    }

    .section-title {
      font-size:20px;
      margin-bottom:8px;
    }

    .border-box {
      border:2px solid #4a7bbf;
      border-radius:4px;
      background:rgba(255,255,255,.4);
      padding:20px;
      text-align:left;
    }

    /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
    .nav-overlay {
      position:absolute;
      inset:0;
      background:rgba(213,233,255,.98);
      display:none;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      z-index:10;
    }
    .nav-overlay.open { display:flex; }

    .nav-close {
      position:absolute;
      top:20px;
      right:20px;
      font-size:28px;
      cursor:pointer;
    }

    .nav-overlay .oval-btn {
      margin:10px 0;
      width:70%;
      text-align:center;
    }
    .nav-link.disabled {
      opacity:.5;
      cursor:default;
    }

    /* å­¦å¹´ã‚¯ãƒ©ã‚¹é¸æŠ */
    .grade-row {
      display:flex;
      gap:8px;
      margin-bottom:12px;
    }
    .grade-select {
      flex:1;
      padding:6px;
      border-radius:4px;
      border:1px solid #9bb4d5;
      background:#f7fbff;
    }

    .input-line {
      width:100%;
      padding:8px;
      margin-bottom:16px;
      border-radius:4px;
      border:1px solid #9bb4d5;
      background:#f7fbff;
    }

    /* å•†å“ä¸€è¦§ */
#products {
  overflow-x: hidden;
  padding-bottom: 24px;
}

    .product-grid {
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:16px 18px;
      justify-items:center;
      margin-top: 18px;
    }

    .product-card {
      width:120px;
      text-align:center;
      position:relative;
    }

    .badge {
      position:absolute;
      top: 6px;
      left: 6px;
      background:#ff2b2b;
      color:#fff;
      font-size:10px;
      padding:4px 6px;
      transform:none;
      border-radius: 8px;
      font-weight:700;
    }

    .product-img {
      width:100%;
      height:86px;
      background:#f5f5f5;
      border-radius:10px;
      border:1px solid rgba(0,0,0,.25);
      margin-bottom:6px;
      overflow:hidden;
    }
    .product-img img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
.price {
      font-size:12px;
      color:#555;
      margin-bottom:2px;
    }

    .qty-control {
      display:flex;
      justify-content:center;
      margin-top:4px;
    }
    .qty-control button {
      width:30px;
      border:1px solid #666;
      background:#fff;
      cursor:pointer;
    }
    .qty-control span {
      width:32px;
      border-top:1px solid #666;
      border-bottom:1px solid #666;
      text-align:center;
    }


    /* ãƒã‚§ãƒƒã‚¯å¼ï¼ˆãŠå¼å½“ï¼‰ */
    .select-control{
      display:flex;
      justify-content:center;
      margin-top:8px;
    }
    .check-wrap{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:14px;
      user-select:none;
    }
    .check-wrap input{
      width:18px;
      height:18px;
      cursor:pointer;
    }

    
    .check-wrap span{ display:none; }
    .check-wrap{ justify-content:center; }
/* æ³¨æ–‡ã‚­ãƒ£ãƒ³ã‚»ãƒ« */
    .order-actions{
      margin-top:10px;
      display:flex;
      justify-content:flex-end;
      gap:8px;
      align-items:center;
    }
    .cancel-order{
      border:1px solid #666;
      background:#fff;
      padding:6px 10px;
      border-radius:6px;
      cursor:pointer;
      font-size:12px;
    }
    .canceled-label{
      font-size:12px;
      color:#444;
    }

    /* å•†å“ä¸€è¦§ï¼šä¾¡æ ¼ï¼‹ã‚«ãƒ¼ãƒˆã®ãƒ˜ãƒƒãƒ€ãƒ¼ */

    .products-topbar{
      /* å›ºå®šï¼ˆstickyï¼‰ã‚’ã‚„ã‚ã¦ã€å•†å“ã‚«ãƒ¼ãƒ‰ã¨é‡ãªã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹ */
      position: relative;
      z-index: 2;

      /* app-main ã®å·¦å³padding(24px)ã‚’ãã®ã¾ã¾ä½¿ã†ï¼ˆè¦‹åˆ‡ã‚Œé˜²æ­¢ï¼‰ */
      margin: 0 0 14px;
      padding: 10px 0 12px;

      display:flex;
      flex-direction:column;
      gap:6px;
    }
    /* èƒŒæ™¯ã ã‘ã‚’å·¦å³ã„ã£ã±ã„ã«ä¼¸ã°ã™ï¼ˆæ–‡å­—ã¯paddingå†…ãªã®ã§è¦‹åˆ‡ã‚Œãªã„ï¼‰ */
    .products-topbar::before{
      content:"";
      position:absolute;
      left:-24px;
      right:-24px;
      top:0;
      bottom:0;
      background: #d5e9ff;
      border-bottom:2px solid #4a7bbf;
      z-index:-1;
    }
.products-topbar-row1{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .products-title{
      font-size:16px;
      font-weight:800;
      line-height:1.2;
    }
    .products-prices{
      font-size:13px;
      line-height:1.35;
      text-align:left;
      white-space: normal;
      word-break: break-word;
      overflow-wrap: anywhere;
      max-width: 100%;
    }
    .products-time{
      font-size:12px;
      color:#555;
      text-align:left;
    }

    /* ã‚«ãƒ¼ãƒˆãƒœã‚¿ãƒ³ï¼ˆå•†å“ä¸€è¦§ãƒ˜ãƒƒãƒ€ãƒ¼å³ï¼‰ */
    .cart-toggle{
      flex:0 0 auto;
      width:38px;
      height:38px;
      border-radius:10px;
      border:1px solid #4a7bbf;
      background:rgba(255,255,255,.75);
      cursor:pointer;
      font-size:20px;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:none;
    }
    .cart-toggle:active{
      transform: translateY(1px);
    }
/* ã‚«ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« */
    .cart-modal {
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      width:86%;
      max-width:320px;
      background:#e5e5e5;
      border-radius:6px;
      padding:14px 18px 20px;
      box-shadow:0 8px 20px rgba(0,0,0,.3);
      z-index:20;
      display:none;
    }
    .cart-modal.open { display:block; }

    .cart-modal-header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:10px;
    }
    .cart-title {
      font-weight:700;
      font-size:18px;
    }
    .cart-header-right {
      display:flex;
      align-items:center;
      gap:8px;
      font-size:16px;
    }
    .cart-close {
      cursor:pointer;
      font-size:18px;
    }

    .cart-items {
      margin-top:8px;
      line-height:1.6;
      min-height:40px;
      font-size:14px;
    }

    .cart-sides {
      margin-top:12px;
      font-size:13px;
      line-height:1.5;
    }

    .side-row {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-top:4px;
    }
    .side-name { flex:1; }

    .side-qty {
      display:flex;
      align-items:center;
    }
    .side-qty button {
      width:26px;
      height:24px;
      border:1px solid #666;
      background:#fff;
      cursor:pointer;
    }
    .side-num {
      width:26px;
      text-align:center;
      border-top:1px solid #666;
      border-bottom:1px solid #666;
      line-height:24px;
    }

    #sideRemaining {
      margin:4px 0 6px;
      font-size:12px;
    }

    .pickup-box {
      margin-top:10px;
      font-size:13px;
    }
    .pickup-box label {
      display:block;
      margin-top:4px;
    }

    .orders-box {
      height:380px;
      overflow-y:auto;
      background:#e5e5e5;
    }

    .order-item {
      font-size:13px;
      padding-bottom:8px;
      margin-bottom:8px;
      border-bottom:1px solid #bbb;
    }
    .order-time { font-weight:600; margin-bottom:4px; }

    #searchResultMsg {
      font-size:12px;
      margin:4px 0 0;
      color:#333;
    }

    /* åˆæœŸåŒ–ãƒœã‚¿ãƒ³ */
    .reset-container {
      position:absolute;
      right:20px;
      bottom:20px;
    }
    .reset-btn {
      font-size:11px;
      padding:6px 10px;
      border-radius:6px;
      border:1px solid #888;
      background:#fff;
      color:#cc0000;
      cursor:pointer;
    }
    .reset-btn:hover { background:#ffecec; }
  
    html, body, .phone-shell, .app-main, .screen, #products { overflow-x: hidden !important; }
.side-info{
      margin-top:18px;
      padding:12px 14px;
      border:2px solid #4b81d6;
      border-radius:8px;
      background:#d9ecff;
      font-size:12px;
      white-space: normal;
      overflow: visible;
      text-overflow: clip;
    }
    .side-title{ font-weight:700; margin-bottom:6px; }
    .side-list{ margin:0; padding-left:18px; }
    .side-list li{ margin:2px 0; }

    /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼è¦‹ãŸç›®ï¼ˆç™½ã„å¸¯ã‚’æ¶ˆã™ï¼‰ */
    .app-main::-webkit-scrollbar{ width:10px; }
    .app-main::-webkit-scrollbar-track{ background:transparent; }
    .app-main::-webkit-scrollbar-thumb{
      background: rgba(0,0,0,0.35);
      border-radius: 10px;
    }

  </style>
</head>
<body>
  <div class="phone-shell">
    <header class="app-header">
      <div class="search-wrapper">
        <input type="search" class="search-input" placeholder=" ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œç´¢" />
        <span class="search-icon">ğŸ”</span>
      </div>
      <div class="menu-icon" id="menuBtn">
        <span></span><span></span><span></span>
      </div>
    </header>

    
    <div class="nav-overlay" id="navOverlay">
      <div class="nav-close" id="navClose">Ã—</div>
      <button class="oval-btn nav-link" data-screen="home">HOME</button>
      <button class="oval-btn nav-link" data-screen="news">ãŠçŸ¥ã‚‰ã›</button>
      <button class="oval-btn nav-link" data-screen="products">å•†å“ä¸€è¦§</button>
      <button class="oval-btn nav-link" data-screen="orders">æ³¨æ–‡å±¥æ­´</button>
      <button class="oval-btn nav-link" data-screen="howto">æ“ä½œæ–¹æ³•</button>
    </div>

    <main class="app-main no-scroll">
      
      <section class="screen active" id="home">
        <div class="icon-placeholder">
          <img src="/static/img/campuscart.png"
               alt="CampusCart ãƒ­ã‚´">
        </div>

        <h1 class="app-title">Campus Cart</h1>

        <p class="catchcopy">
          è³¼è²·ã‚’ã‚‚ã£ã¨ä¾¿åˆ©ã«<br>ã‚‚ã£ã¨ç”»æœŸçš„ã«
        </p>

        <button class="rect-btn" id="goReserve">äºˆç´„æ³¨æ–‡</button>

        <div class="reset-container">
          <button type="button" class="reset-btn" id="resetBtn">åˆæœŸåŒ–</button>
        </div>
      </section>

      
      <section class="screen" id="reserve">
        <h2 class="section-title" style="margin-bottom:18px;">
          å­¦å¹´ãƒ»çµ„ãƒ»å¸­ã‚’é¸ã‚“ã§ãã ã•ã„
        </h2>

        <div class="border-box">
          <p style="margin-top:0;">ä¾‹ï¼‰1å¹´3çµ„12å¸­</p>
          <div class="grade-row">
            <select id="gradeSelect" class="grade-select">
              <option value="">å­¦å¹´</option>
              <option value="1å¹´">1å¹´</option>
              <option value="2å¹´">2å¹´</option>
              <option value="3å¹´">3å¹´</option>
            </select>
            <select id="classSelect" class="grade-select">
              <option value="">çµ„</option>
              <option value="1çµ„">1çµ„</option>
              <option value="2çµ„">2çµ„</option>
              <option value="3çµ„">3çµ„</option>
              <option value="4çµ„">4çµ„</option>
            </select>
            <select id="seatSelect" class="grade-select">
              <option value="">å¸­</option>
            </select>
          </div>
<p style="margin:12px 0 6px;">åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br>ä¾‹ï¼‰å±±ç”° å¤ªéƒ</p>
          <input type="text" id="nameInput" class="input-line"
                 placeholder="ä¾‹ï¼‰å±±ç”° å¤ªéƒ">

          <div style="text-align:center;">
            <button class="oval-btn" id="createAccount">ä½œæˆ</button>
          </div>
        </div>
        <p id="reserveMsg" style="margin-top:12px;font-size:14px;"></p>
      </section>

      
      <section class="screen" id="phone">
        <div class="icon-placeholder">
          <img src="/static/img/campuscart.png"
               alt="CampusCart ãƒ­ã‚´">
        </div>

        <h1 class="app-title">Campus Cart</h1>
        <p class="catchcopy">
          è³¼è²·ã‚’ã‚‚ã£ã¨ä¾¿åˆ©ã«<br>ã‚‚ã£ã¨ç”»æœŸçš„ã«
        </p>

        <p id="userInfo" style="font-size:14px;margin-bottom:16px;"></p>

        <input type="tel" id="phoneInput" class="input-line"
               style="max-width:260px;"
               placeholder="é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
        <button class="oval-btn" id="phoneRegister">â˜ é›»è©±ç•ªå·ç™»éŒ²</button>
        <p id="phoneMsg" style="margin-top:12px;font-size:14px;"></p>
      </section>

      
      <section class="screen" id="products">
        <div class="products-topbar">
          <div class="products-topbar-row1">
            <div class="products-title">å•†å“ä¸€è¦§</div>
            <button type="button" class="cart-toggle" id="cartToggle" aria-label="ã‚«ãƒ¼ãƒˆã‚’é–‹ã">ğŸ›’</button>
          </div>
          <div class="products-prices">ãŠå¼å½“ <b>460å††</b> / é€±æ›¿ã‚ã‚Šå¼å½“ <b>460å††</b><br>æ—¥æ›¿ã‚ã‚Šå¼å½“ <b>610å††</b></div>
          <div class="products-time">æ³¨æ–‡å—ä»˜æ™‚é–“ï¼š8:00ã€œ13:00</div>
        </div>
        <p id="searchResultMsg"></p>

        
        <div class="product-grid">
          <div class="product-card" data-name="å”æšã’å¼å½“">
            <div class="badge">äººæ°— No.1</div>
            <div class="product-img"><img src="/static/img/staticimgebihuraitosiramisakanahurai.jpg" alt="å”æšã’å¼å½“"></div>
            <div>å”æšã’å¼å½“</div>
            <div class="price">460å††</div>

            <div class="select-control">
              <label class="check-wrap">
                <input type="checkbox" class="bento-check">
                <span>é¸ã¶</span>
              </label>
            </div>
          </div>

          <div class="product-card" data-name="ãƒã‚­ãƒ³ã‚«ãƒ„å¼å½“">
            <div class="product-img"><img src="/static/img/staticimgtikinnkatu.jpg" alt="ãƒã‚­ãƒ³ã‚«ãƒ„å¼å½“"></div>
            <div>ãƒã‚­ãƒ³ã‚«ãƒ„å¼å½“</div>
            <div class="price">460å††</div>

            <div class="select-control">
              <label class="check-wrap">
                <input type="checkbox" class="bento-check">
                <span>é¸ã¶</span>
              </label>
            </div>
          </div>

          <div class="product-card" data-name="ç„¼ãè‚‰ã¨ã‚¯ãƒªãƒ¼ãƒ ã‚³ãƒ­ãƒƒã‚±å¼å½“">
            <div class="product-img"><img src="/static/img/staticimgyakinikutokuri-mukorokke.jpg" alt="ç„¼ãè‚‰ã¨ã‚¯ãƒªãƒ¼ãƒ ã‚³ãƒ­ãƒƒã‚±å¼å½“"></div>
            <div style="font-size:12px;">ç„¼ãè‚‰ã¨<br>ã‚¯ãƒªãƒ¼ãƒ ã‚³ãƒ­ãƒƒã‚±å¼å½“</div>
            <div class="price">460å††</div>

            <div class="select-control">
              <label class="check-wrap">
                <input type="checkbox" class="bento-check">
                <span>é¸ã¶</span>
              </label>
            </div>
          </div>

          <div class="product-card" data-name="ã‚¨ãƒ“ãƒ•ãƒ©ã‚¤ã¨ç™½èº«é­šãƒ•ãƒ©ã‚¤å¼å½“">
            <div class="product-img"><img src="/static/img/staticimgkaraage.jpg" alt="ã‚¨ãƒ“ãƒ•ãƒ©ã‚¤ã¨ç™½èº«é­šãƒ•ãƒ©ã‚¤å¼å½“"></div>
            <div style="font-size:12px;">ã‚¨ãƒ“ãƒ•ãƒ©ã‚¤ã¨<br>ç™½èº«é­šãƒ•ãƒ©ã‚¤å¼å½“</div>
            <div class="price">460å††</div>

            <div class="select-control">
              <label class="check-wrap">
                <input type="checkbox" class="bento-check">
                <span>é¸ã¶</span>
              </label>
            </div>
          </div>

          
          
          
          <div class="product-card" data-name="é€±æ›¿ã‚ã‚Šå¼å½“">
            <div class="product-img"><img src="/static/img/campuscart.png" alt="é€±æ›¿ã‚ã‚Šå¼å½“"></div>

          
            <div>é€±æ›¿ã‚ã‚Šå¼å½“</div>

          
            <div class="price">460å††</div>


          
            <div class="select-control">

          
            <label class="check-wrap">

          
            <input type="checkbox" class="bento-check">

          
            <span>é¸ã¶</span>

          
            </label>

          
            </div>

          
            </div>

<div class="product-card" data-name="æ—¥æ›¿ã‚ã‚Šå¼å½“">
            <div class="product-img"><img src="/static/img/campuscart.png" alt="æ—¥æ›¿ã‚ã‚Šå¼å½“"></div>
            <div>æ—¥æ›¿ã‚ã‚Šå¼å½“</div>
            <div class="price">610å††</div>

            <div class="select-control">
              <label class="check-wrap">
                <input type="checkbox" class="bento-check">
                <span>é¸ã¶</span>
              </label>
            </div>
          </div>



        </div>

        <div class="side-info">
          <div class="side-title">ï¼‹1å“ï¼ˆãŠã‹ãšè¿½åŠ ï¼‰</div>
          <ul class="side-list">
            <li>é¶ã®ã‹ã‚‰æšã’ï¼ˆ2ãƒ¶ï¼‰</li>
            <li>ã‚µãƒã®ç…®ã¤ã‘</li>
            <li>ç™½èº«é­šãƒ•ãƒ©ã‚¤</li>
            <li>ã‚·ãƒ¥ãƒ¼ãƒã‚¤</li>
            <li>ã‚¨ãƒ“ã¨æè±†ã®ã—ã‚“ã˜ã‚‡å¤©</li>
          </ul>
        </div>


        
        <div class="cart-modal" id="cartModal">
          <div class="cart-modal-header">
            <div class="cart-title">ã‚«ãƒ¼ãƒˆ</div>
            <div class="cart-header-right">
              <span>ğŸ›’</span>
              <span class="cart-close" id="cartClose">Ã—</span>
            </div>
          </div>

          <div id="cartItems" class="cart-items">
            ã¾ã å•†å“ãŒå…¥ã£ã¦ã„ã¾ã›ã‚“
          </div>

          <div class="cart-sides">
            <p style="margin:8px 0 0;">ï¼‹ï¼‘å“ï¼ˆãŠã‹ãšï¼‰</p>
            <p id="sideRemaining">æ®‹ã‚Šï¼š0å“</p>


            <div class="side-row" data-side="é¶ã®ã‹ã‚‰æšã’ï¼ˆ2ãƒ¶ï¼‰">
              <span class="side-name">é¶ã®ã‹ã‚‰æšã’ï¼ˆ2ãƒ¶ï¼‰</span>
              <div class="side-qty">
                <button class="side-minus">ï¼</button>
                <span class="side-num">0</span>
                <button class="side-plus">ï¼‹</button>
              </div>
            </div>

            <div class="side-row" data-side="ã‚µãƒã®ç…®ã¤ã‘">
              <span class="side-name">ã‚µãƒã®ç…®ã¤ã‘</span>
              <div class="side-qty">
                <button class="side-minus">ï¼</button>
                <span class="side-num">0</span>
                <button class="side-plus">ï¼‹</button>
              </div>
            </div>

            <div class="side-row" data-side="ç™½èº«é­šãƒ•ãƒ©ã‚¤">
              <span class="side-name">ç™½èº«é­šãƒ•ãƒ©ã‚¤</span>
              <div class="side-qty">
                <button class="side-minus">ï¼</button>
                <span class="side-num">0</span>
                <button class="side-plus">ï¼‹</button>
              </div>
            </div>

            <div class="side-row" data-side="ã‚·ãƒ¥ãƒ¼ãƒã‚¤">
              <span class="side-name">ã‚·ãƒ¥ãƒ¼ãƒã‚¤</span>
              <div class="side-qty">
                <button class="side-minus">ï¼</button>
                <span class="side-num">0</span>
                <button class="side-plus">ï¼‹</button>
              </div>
            </div>

            <div class="side-row" data-side="ã‚¨ãƒ“ã¨æè±†ã®ã—ã‚“ã˜ã‚‡å¤©">
              <span class="side-name">ã‚¨ãƒ“ã¨æè±†ã®ã—ã‚“ã˜ã‚‡å¤©</span>
              <div class="side-qty">
                <button class="side-minus">ï¼</button>
                <span class="side-num">0</span>
                <button class="side-plus">ï¼‹</button>
              </div>
            </div>

          
          </div>

          <div class="pickup-box">
            <p>å—ã‘å–ã‚Šæ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
            <label><input type="radio" name="pickupTime" value="12:50" checked> 12:50</label>
            <label><input type="radio" name="pickupTime" value="13:00"> 13:00</label>
          </div>

          <button class="oval-btn" id="purchaseBtn"
                  style="margin-top:12px;">è³¼å…¥ã™ã‚‹</button>
        </div>
      </section>

      
      <section class="screen" id="orders">
        <h2 class="section-title">- æ³¨æ–‡å±¥æ­´ -</h2>
        <div id="ordersList" class="border-box orders-box">
          æ³¨æ–‡å±¥æ­´ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“
        </div>
      </section>

      
      <section class="screen" id="howto">
        <h2 class="section-title">- æ“ä½œæ–¹æ³• -</h2>
        <div class="border-box">
          <p>â‘  HOMEç”»é¢ã®ã€Œäºˆç´„æ³¨æ–‡ã€ã‹ã‚‰ã€å­¦å¹´ã‚¯ãƒ©ã‚¹ãƒ»åå‰ãƒ»é›»è©±ç•ªå·ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚</p>
          <p>â‘¡ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€Œå•†å“ä¸€è¦§ã€ã‚’é¸ã³ã€ãŠå¼å½“ã®æ•°é‡ã‚’ ï¼‹ï¼ï¼ ãƒœã‚¿ãƒ³ã§å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚</p>
          <p>â‘¢ å³ä¸Šã®ã‚«ãƒ¼ãƒˆã‚’é–‹ãã€ï¼‹ï¼‘å“ï¼ˆãŠã‹ãšï¼‰ã®å€‹æ•°ã‚’æ±ºã‚ã¦ã€Œè³¼å…¥ã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰</p>
          <p>â‘£ è³¼å…¥æ™‚ã«å—ã‘å–ã‚Šæ™‚é–“ï¼ˆ12:50 ã¾ãŸã¯ 13:00ï¼‰ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>
          <p>â‘¤ ã€Œæ³¨æ–‡å±¥æ­´ã€ã‹ã‚‰éå»ã®æ³¨æ–‡å†…å®¹ã¨å—ã‘å–ã‚Šæ™‚é–“ã‚’ç¢ºèªã§ãã¾ã™ã€‚</p>
        </div>
      </section>

      
      <section class="screen" id="news">
        <h2 class="section-title">- ãŠçŸ¥ã‚‰ã› -</h2>
        <p>ãŠçŸ¥ã‚‰ã›ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
      </section>
    </main>
  </div>

  <script>
    // â–¼GASã®ä¿å­˜å…ˆURLï¼ˆ/execï¼‰ã‚’ã“ã“ã§ç®¡ç†ã—ã¾ã™
    // åˆå›ã ã‘URLå…¥åŠ›â†’ä»¥å¾Œã¯ç«¯æœ«ã«ä¿å­˜ã•ã‚Œã¾ã™ï¼ˆlocalStorageï¼‰
    const GAS_URL_KEY = "campusCartGASUrl";
    // â–¼å›ºå®šï¼šã“ã®HTMLã¯æŒ‡å®šã®GAS /exec ã‚’è‡ªå‹•è¨­å®šã—ã¾ã™
    const __DESIRED_GAS_URL__ = "https://script.google.com/macros/s/AKfycbxI0NbVrSYQVfKgyhN-mEGYIb9X6UeyvnFNJtDX1QS0JuAmTxThRWr89fxu3SeLhWk/exec";
    if (localStorage.getItem(GAS_URL_KEY) !== __DESIRED_GAS_URL__) {
      localStorage.setItem(GAS_URL_KEY, __DESIRED_GAS_URL__);
      // 1å›ã ã‘å†èª­ã¿è¾¼ã¿ã—ã¦ç¢ºå®Ÿã«åæ˜ 
      location.reload();
    }

    const DEFAULT_SHEET_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbx8zxFNi-2ToA5wdtjYlhNGlBgDhV1pJA8Nhl8tyhSRg_8P3cSLeDafWtgXwUKPKGV6/exec";
    let SHEET_WEBAPP_URL = localStorage.getItem(GAS_URL_KEY) || DEFAULT_SHEET_WEBAPP_URL;

    if (!localStorage.getItem(GAS_URL_KEY)) {
      const u = prompt("æ³¨æ–‡è¨˜éŒ²ç”¨ã®GAS /exec URL ã‚’è²¼ã£ã¦ãã ã•ã„ï¼ˆä¸€åº¦ã ã‘ï¼‰", DEFAULT_SHEET_WEBAPP_URL);
      if (u && u.includes("/exec")) {
        SHEET_WEBAPP_URL = u.trim();
        localStorage.setItem(GAS_URL_KEY, SHEET_WEBAPP_URL);
        alert("ä¿å­˜ã—ã¾ã—ãŸã€‚æ¬¡å›ã‹ã‚‰è‡ªå‹•ã§ä½¿ã‚ã‚Œã¾ã™ã€‚");
      } else {
        alert("URLãŒç©º/ä¸æ­£ã§ã™ã€‚è¨˜éŒ²ã§ããªã„å ´åˆã¯ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦URLã‚’è²¼ã£ã¦ãã ã•ã„ã€‚");
      }
    }

    // å¾Œã‹ã‚‰å¤‰æ›´ã—ãŸã„æ™‚ï¼ˆChromeã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å®Ÿè¡Œï¼‰
    // setGASUrl("https://script.google.com/macros/s/....../exec")
    window.setGASUrl = (u) => {
      if (!u || !String(u).includes("/exec")) return alert("ä¸æ­£ãªURL");
      localStorage.setItem(GAS_URL_KEY, String(u).trim());
      alert("ä¿å­˜ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚");
    };


const USER_KEY = "campusCartUser";
    const ORDERS_KEY = "campusCartOrders";

    const SEARCH_KEYWORD_MAP = {
      "ã‹ã‚‰ã‚ã’":"å”æšã’å¼å½“","å”æšã’":"å”æšã’å¼å½“","å”æšã’å¼å½“":"å”æšã’å¼å½“","ã‹ã‚‰æšã’":"å”æšã’å¼å½“",
      "ãƒã‚­ãƒ³":"ãƒã‚­ãƒ³ã‚«ãƒ„å¼å½“","ã‚«ãƒ„":"ãƒã‚­ãƒ³ã‚«ãƒ„å¼å½“","ãƒã‚­ãƒ³ã‚«ãƒ„":"ãƒã‚­ãƒ³ã‚«ãƒ„å¼å½“",
      "ã‚¨ãƒ“":"ã‚¨ãƒ“ãƒ•ãƒ©ã‚¤ã¨ã‚½ãƒ¼ã‚»ãƒ¼ã‚¸ã‚«ãƒ„å¼å½“","æµ·è€":"ã‚¨ãƒ“ãƒ•ãƒ©ã‚¤ã¨ã‚½ãƒ¼ã‚»ãƒ¼ã‚¸ã‚«ãƒ„å¼å½“","ã‚½ãƒ¼ã‚»ãƒ¼ã‚¸":"ã‚¨ãƒ“ãƒ•ãƒ©ã‚¤ã¨ã‚½ãƒ¼ã‚»ãƒ¼ã‚¸ã‚«ãƒ„å¼å½“",
      "ç„¼ãè‚‰":"ç„¼ãè‚‰ã¨ã‚¯ãƒªãƒ¼ãƒ ã‚³ãƒ­ãƒƒã‚±å¼å½“","ã‚³ãƒ­ãƒƒã‚±":"ç„¼ãè‚‰ã¨ã‚¯ãƒªãƒ¼ãƒ ã‚³ãƒ­ãƒƒã‚±å¼å½“",
      "æ—¥æ›¿ã‚ã‚Š":"æ—¥æ›¿ã‚ã‚Šå¼å½“","ã²ãŒã‚ã‚Š":"æ—¥æ›¿ã‚ã‚Šå¼å½“"
    };

    let userData = {};
    let orders = [];
    let userRegistered = false;
    let menuBtn, searchInput;
    let cartToggle, cartModal;

    const normalize = s => s.replace(/\s+/g,"").toLowerCase();

    const showScreen = id => {
      document.querySelectorAll(".screen").forEach(s =>
        s.classList.toggle("active", s.id === id)
      );
      const mainEl = document.querySelector(".app-main");
      mainEl.scrollTop = 0;
      mainEl.classList.toggle("no-scroll", ["home","reserve","phone"].includes(id));
    };

    const loadJson = (key, def) => {
      try {
        const raw = localStorage.getItem(key);
        return raw ? JSON.parse(raw) : def;
      } catch { return def; }
    };

    const saveJson = (key, val) =>
      localStorage.setItem(key, JSON.stringify(val));

    const renderOrders = () => {
      const listEl = document.getElementById("ordersList");
      if (!orders.length) {
        listEl.textContent = "æ³¨æ–‡å±¥æ­´ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“";
        return;
      }
      const rev = orders.slice().reverse();
      listEl.innerHTML = rev.map((o,i) => {
        const n = rev.length - i;
        const itemLines = o.items.map(v=>`${v.name} Ã— ${v.qty}`).join("<br>");
        const sideLines = o.sides && o.sides.length
          ? "ï¼‹ï¼‘å“ï¼š" + o.sides.map(v=>`${v.name} Ã— ${v.qty}`).join("ã€")
          : "";
        return `
          <div class="order-item">
            <div class="order-time">æ³¨æ–‡${n}ï¼š${o.time}${o.canceled ? "ï¼ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿ï¼‰" : ""}</div>
            <div>å—ã‘å–ã‚Šæ™‚é–“ï¼š${o.pickup}</div>
            <div>${itemLines}</div>
            ${sideLines ? `<div>${sideLines}</div>` : ""}
            <div class="order-actions">
              ${o.canceled
                ? `<span class="canceled-label">ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿${o.canceledAt ? "ï¼š" + o.canceledAt : ""}</span>`
                : `<button type="button" class="cancel-order" data-id="${o.id}">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>`}
            </div>
          </div>`;
      }).join("");
    };

    const canCancelOrder = (o) => true;

    const cancelOrderById = (id) => {
      const idx = orders.findIndex(o=>o.id===id);
      if (idx < 0) return;
      const o = orders[idx];
      if (o.canceled) return;

      if (!canCancelOrder(o)) {
        alert("ã“ã®æ³¨æ–‡ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§ãã¾ã›ã‚“ã€‚");
        return;
      }
      if (!confirm("ã“ã®æ³¨æ–‡ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ")) return;

      const canceledAt = new Date().toLocaleString("ja-JP");
      o.canceled = true;
      o.canceledAt = canceledAt;
      saveJson(ORDERS_KEY, orders);
      renderOrders();

      const payload = {
        action: "cancel",
        op: "strike",
        orderId: o.id,
        time: o.time,
        grade: userData.grade || "",
        seat: userData.seat  || "",
        name: userData.name  || "",
        phone: userData.phone || "",
        pickup: o.pickup,
        items: o.items || [],
        sides: o.sides || [],
        canceledAt
      };
      fetch(SHEET_WEBAPP_URL, {
        method: "POST",
        mode: "no-cors",
          keepalive: true,
        body: JSON.stringify(payload)
      });

      alert("æ³¨æ–‡ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚");
    };

    const applyUserDataToUI = () => {
      const phoneInput = document.getElementById("phoneInput");
      const userInfo = document.getElementById("userInfo");
      if (userData.phone && phoneInput) phoneInput.value = userData.phone;
      if (userInfo && userData.grade && userData.name) {
        const seat = userData.seat ? `${userData.seat}å¸­` : "";
        userInfo.textContent = `${userData.grade}${seat}ï¼š${userData.name}ã•ã‚“`;
      }
    };

    const enableUI = () => {
      userRegistered = true;
      menuBtn.classList.remove("disabled");
      searchInput.classList.remove("disabled");
      searchInput.disabled = false;
      document.querySelectorAll(".nav-link").forEach(b=>b.classList.remove("disabled"));
    };

    const disableUI = () => {
      userRegistered = false;
      menuBtn.classList.add("disabled");
      searchInput.classList.add("disabled");
      searchInput.disabled = true;
      document.querySelectorAll(".nav-link").forEach(b=>b.classList.add("disabled"));
    };

    const getCartSummary = () => {
      const items = [];
      document.querySelectorAll(".product-card").forEach(card => {
        const chk = card.querySelector(".bento-check");
        if (!chk || !chk.checked) return;

        let name = card.dataset.name || "";
        const v = card.querySelector(".variant-select");
        if (v && !v.disabled && v.value) {
          name = `${name}ï¼ˆ${v.value}ï¼‰`;
        }
        items.push({ name, qty: 1 });
      });
      return items;
    };
    const getTotalBentoQty = () =>
      getCartSummary().reduce((s,v)=>s+v.qty,0);

    const getSideSummary = () => {
      const list = [];
      document.querySelectorAll(".side-row").forEach(row => {
        const qty = parseInt(row.querySelector(".side-num").textContent || "0", 10) || 0;
        if (qty>0) list.push({ name: row.dataset.side, qty });
      });
      return list;
    };
    const getTotalSideQty = () =>
      getSideSummary().reduce((s,v)=>s+v.qty,0);

    const updateSideRemaining = () => {
      const remain = Math.max(getTotalBentoQty()-getTotalSideQty(),0);
      document.getElementById("sideRemaining").textContent =
        `æ®‹ã‚Šï¼š${remain}å“`;
    };

    const updateCartItems = () => {
      const el = document.getElementById("cartItems");
      const items = getCartSummary();
      if (!items.length) {
        el.textContent = "ã¾ã å•†å“ãŒå…¥ã£ã¦ã„ã¾ã›ã‚“";
        updateSideRemaining();
        return;
      }
      el.innerHTML = items.map(v=>`${v.name} Ã— ${v.qty}`).join("<br>");
      updateSideRemaining();
    };

    const resetQuantities = () => {
      document.querySelectorAll(".bento-check").forEach(c=>c.checked=false);
      document.querySelectorAll(".side-row .side-num").forEach(s=>s.textContent="0");
      updateCartItems();
      updateSideRemaining();
    };

    const filterProductsBySearch = () => {
      const raw = searchInput.value.trim();
      if (!userRegistered) {
        if (raw) alert("å…ˆã«äºˆç´„æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      const q = normalize(raw);
      const cards = document.querySelectorAll(".product-card");
      const msgEl = document.getElementById("searchResultMsg");
      showScreen("products");
      if (!q) {
        cards.forEach(c=>c.style.display="block");
        msgEl.textContent = "";
        return;
      }
      const mapped = SEARCH_KEYWORD_MAP[raw] || SEARCH_KEYWORD_MAP[q] || null;
      let hit = 0;
      cards.forEach(card => {
        const name = normalize(card.dataset.name || "");
        const match = mapped ? card.dataset.name===mapped : name.includes(q);
        card.style.display = match ? "block" : "none";
        if (match) hit++;
      });
      msgEl.textContent = hit
        ? `ã€Œ${raw}ã€ã®æ¤œç´¢çµæœï¼š${hit}ä»¶`
        : `ã€Œ${raw}ã€ã«è©²å½“ã™ã‚‹å•†å“ã¯ã‚ã‚Šã¾ã›ã‚“`;
    };

    const resetApp = () => {
      if (!confirm(
        "ã‚¢ãƒ—ãƒªã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚\n\n" +
        "ãƒ»å­¦å¹´ã‚¯ãƒ©ã‚¹\nãƒ»åå‰\nãƒ»é›»è©±ç•ªå·\nãƒ»æ³¨æ–‡å±¥æ­´\n\n" +
        "ãŒå…¨ã¦å‰Šé™¤ã•ã‚Œã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ"
      )) return;

      localStorage.removeItem(USER_KEY);
      localStorage.removeItem(ORDERS_KEY);
      userData = {};
      orders = [];
      renderOrders();
      disableUI();

      ["gradeSelect","classSelect","seatSelect","nameInput","phoneInput"].forEach(id=>{
        const el=document.getElementById(id);
        if(el) el.value="";
      });
      document.getElementById("userInfo").textContent="";
      document.getElementById("reserveMsg").textContent="";
      document.getElementById("phoneMsg").textContent="";
      searchInput.value="";
      document.getElementById("searchResultMsg").textContent="";
      resetQuantities();
      showScreen("home");
    };

    document.addEventListener("DOMContentLoaded", () => {
      try {
        localStorage.setItem("__test","1");
        localStorage.removeItem("__test");
      } catch {
        alert("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯æƒ…å ±ã‚’ä¿å­˜ã§ãã¾ã›ã‚“ã€‚");
      }

      menuBtn = document.getElementById("menuBtn");
      searchInput = document.querySelector(".search-input");
      const navOverlay = document.getElementById("navOverlay");
      const navClose = document.getElementById("navClose");
      cartToggle = document.getElementById("cartToggle");
      cartModal  = document.getElementById("cartModal");
      const cartClose = document.getElementById("cartClose");
      const purchaseBtn = document.getElementById("purchaseBtn");

      
      // å¸­ç•ªå·ã‚»ãƒ¬ã‚¯ãƒˆï¼ˆ1ã€œ45ï¼‰ã‚’ç”Ÿæˆ
      const seatSel = document.getElementById("seatSelect");
      if (seatSel && seatSel.options.length <= 1) {
        for (let i = 1; i <= 45; i++) {
          const opt = document.createElement("option");
          opt.value = String(i);
          opt.textContent = String(i);
          seatSel.appendChild(opt);
        }
      }

      userData = loadJson(USER_KEY,{});
      orders  = loadJson(ORDERS_KEY,[]);
      orders = orders.map((o,idx)=>{
        if (!o.id) o.id = `o_${Date.now()}_${idx}`;
        if (o.canceled === undefined) o.canceled = false;
        return o;
      });
      saveJson(ORDERS_KEY, orders);
      renderOrders();

      document.getElementById("ordersList").addEventListener("click",(e)=>{
        const btn = e.target.closest(".cancel-order");
        if (!btn) return;
        cancelOrderById(btn.dataset.id);
      });

      if (userData.grade && userData.name && userData.phone) enableUI();
      else disableUI();

      applyUserDataToUI();
      showScreen("home");

      menuBtn.addEventListener("click", ()=>{
        if (!userRegistered) return;
        navOverlay.classList.add("open");
      });
      navClose.addEventListener("click", ()=>navOverlay.classList.remove("open"));
      document.querySelectorAll(".nav-link").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          if (!userRegistered) return;
          showScreen(btn.dataset.screen);
          navOverlay.classList.remove("open");
        });
      });

      document.getElementById("goReserve").addEventListener("click", ()=>
        showScreen("reserve")
      );

      document.getElementById("createAccount").addEventListener("click",()=>{
        const grade = document.getElementById("gradeSelect").value;
        const clss  = document.getElementById("classSelect").value;
        const seatRaw = document.getElementById("seatSelect").value;
        const name  = document.getElementById("nameInput").value.trim();
        const msg   = document.getElementById("reserveMsg");

        const seat = parseInt(String(seatRaw || "").trim(), 10);

        if (!grade || !clss || !seatRaw || !name) {
          msg.textContent = "å­¦å¹´ãƒ»ã‚¯ãƒ©ã‚¹ãƒ»å¸­ç•ªå·ãƒ»åå‰ã‚’ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
          return;
        }
        if (!Number.isInteger(seat) || seat < 1 || seat > 45) {
          msg.textContent = "å¸­ç•ªå·ã¯1ã€œ45ã®æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
          return;
        }

        userData.grade = grade + clss;
        userData.seat  = seat;
        userData.name  = name;
        saveJson(USER_KEY,userData);
        applyUserDataToUI();
        msg.textContent = `${userData.grade}${seat}å¸­ï¼š${name}ã•ã‚“ã®æƒ…å ±ã‚’ä½œæˆã—ã¾ã—ãŸã€‚ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰`;
        showScreen("phone");
      });

      document.getElementById("phoneRegister").addEventListener("click",()=>{
        const raw = document.getElementById("phoneInput").value.trim();
        const msg = document.getElementById("phoneMsg");
        if (!raw) {
          msg.textContent = "é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
          return;
        }
        const phone = raw.replace(/\s+/g,"");
        if (!/^[0-9]+$/.test(phone)) {
          msg.textContent = "é›»è©±ç•ªå·ã¯æ•°å­—ã ã‘ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
          return;
        }
        userData.phone = phone;
        saveJson(USER_KEY,userData);
        applyUserDataToUI();
        msg.textContent = `é›»è©±ç•ªå·ã€Œ${phone}ã€ã‚’ç™»éŒ²ã—ã¾ã—ãŸã€‚`;
        enableUI();
      });

      cartToggle.addEventListener("click",()=>{
        if (!userRegistered) {
          alert("å…ˆã«äºˆç´„æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
          return;
        }
        updateCartItems();
        cartModal.classList.add("open");
      });
      cartClose.addEventListener("click",()=>
        cartModal.classList.remove("open")
      );

      document.querySelectorAll(".bento-check").forEach(chk=>{
        chk.addEventListener("change", ()=>{
          const card = chk.closest(".product-card");
          const v = card ? card.querySelector(".variant-select") : null;
          if (v) v.disabled = !chk.checked;
          updateCartItems();
        });
      });
      document.querySelectorAll(".variant-select").forEach(sel=>{
        sel.addEventListener("change", updateCartItems);
      });

      document.querySelectorAll(".side-row").forEach(row=>{
        const minus = row.querySelector(".side-minus");
        const plus  = row.querySelector(".side-plus");
        const numSpan = row.querySelector(".side-num");
        let num = parseInt(numSpan.textContent||"0",10)||0;
        minus.addEventListener("click",()=>{
          num=Math.max(0,num-1);
          numSpan.textContent=num;
          updateSideRemaining();
        });
        plus.addEventListener("click",()=>{
          const bentoTotal=getTotalBentoQty();
          const sideTotal=getTotalSideQty();
          if (!bentoTotal) { alert("ã¾ãšãŠå¼å½“ã‚’ã‚«ãƒ¼ãƒˆã«å…¥ã‚Œã¦ãã ã•ã„ã€‚"); return; }
          if (sideTotal>=bentoTotal) { alert("ãŠã‹ãšã®åˆè¨ˆã¯å¼å½“ã®å€‹æ•°ã¾ã§ã§ã™ã€‚"); return; }
          num++;
          numSpan.textContent=num;
          updateSideRemaining();
        });
      });

      updateCartItems();
      updateSideRemaining();

      purchaseBtn.addEventListener("click",()=>{
        if (!userRegistered) {
          alert("è³¼å…¥å‰ã«ã€å­¦å¹´ã‚¯ãƒ©ã‚¹ãƒ»åå‰ãƒ»é›»è©±ç•ªå·ã®ç™»éŒ²ãŒå¿…è¦ã§ã™ã€‚");
          showScreen((userData.grade && userData.name) ? "phone" : "reserve");
          return;
        }
        const now = new Date();
        // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šæ™‚é–“åˆ¶é™ã‚’ä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ–ï¼ˆã„ã¤ã§ã‚‚è³¼å…¥å¯èƒ½ï¼‰
        const items = getCartSummary();
        if (!items.length) {
          alert("å•†å“ãŒã‚«ãƒ¼ãƒˆã«å…¥ã£ã¦ã„ã¾ã›ã‚“ã€‚");
          return;
        }
        const sides = getSideSummary();
        const bentoTotal = getTotalBentoQty();
        const sideTotal  = getTotalSideQty();
        if (sideTotal>bentoTotal) {
          alert("ãŠã‹ãšã®åˆè¨ˆã¯å¼å½“ã®å€‹æ•°ã¾ã§ã«ã—ã¦ãã ã•ã„ã€‚");
          return;
        }
        if (!sideTotal && bentoTotal>0) {
          if (!confirm("ï¼‹ï¼‘å“ã®ãŠã‹ãšãŒé¸ã°ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\næœ¬å½“ã«ãŠã‹ãšãªã—ã§ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) {
            return;
          }
        }
        const pickupRadio = document.querySelector('input[name="pickupTime"]:checked');
        const pickup = pickupRadio ? pickupRadio.value : "12:50";

        const lines = items.map(v=>`${v.name} Ã— ${v.qty}`).join("\n");
        const sideLines = sides.map(v=>`${v.name} Ã— ${v.qty}`).join("\n");

        const timeStr = now.toLocaleString("ja-JP");
        const orderId = "o_" + now.getTime();

        // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«é€ã‚‹ãƒ‡ãƒ¼ã‚¿
        const payload = {
          action: "order",
          orderId,
          time:  timeStr,
          grade: userData.grade || "",
          seat:  userData.seat  || "",
          name:  userData.name  || "",
          phone: userData.phone || "",
          pickup,
          items,
          sides
        };

        // Google Apps Script ã® Web ã‚¢ãƒ—ãƒªã«é€ä¿¡
        fetch(SHEET_WEBAPP_URL, {
          method: "POST",
          mode: "no-cors",
          keepalive: true,
          body: JSON.stringify(payload)
        });

        alert(
          "ä»¥ä¸‹ã®å†…å®¹ã§æ³¨æ–‡ã—ã¾ã—ãŸã€‚\n\n" +
          `å—ã‘å–ã‚Šæ™‚é–“ï¼š${pickup}\n\n` +
          lines +
          (sideLines ? "\n\nï¼‹ï¼‘å“ï¼š\n"+sideLines : "")
        );

        orders.push({ id:orderId, time:timeStr, pickup, items, sides, canceled:false });
        saveJson(ORDERS_KEY, orders);
        renderOrders();

        resetQuantities();
        cartModal.classList.remove("open");
      });

      searchInput.addEventListener("keydown",e=>{
        if (e.key==="Enter") {
          e.preventDefault();
          filterProductsBySearch();
        }
      });
      searchInput.addEventListener("input",()=>{
        if (!searchInput.value.trim()) {
          document.querySelectorAll(".product-card")
            .forEach(c=>c.style.display="block");
          document.getElementById("searchResultMsg").textContent="";
        }
      });

      document.getElementById("resetBtn").addEventListener("click", resetApp);
    });
  </script>
</body>
</html>
